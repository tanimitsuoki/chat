<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <title>Chatã‚¢ãƒ—ãƒª</title>
  <link rel="stylesheet" href="css/chat.css">
</head>

<body>
  <!-- ãƒ–ãƒ©ã‚¦ã‚¶ã®ç”»é¢ã«è¦‹ãˆã‚‹å†…å®¹ -->



 <div class="a">
    <div >
      <img src="https://firebasestorage.googleapis.com/v0/b/dev18-chat01-23024.appspot.com/o/buke.png?alt=media&token=5695a19a-dc4f-41af-983c-4082eb55e7dc" alt="ãƒˆãƒƒãƒ—" class="g">
    </div>
    <p class="title">chatã‚¢ãƒ—ãƒª</p>
  </div>

  <div id="output3">
    <!-- ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹ç®‡æ‰€ -->
    <div id="output" class="c"></div>
    <div id="output2"></div>
  </div>


   <div>
    <!-- æ—¥ä»˜ -->
    æ—¥ä»˜
    <input type="date" id="date" class="date1">
  </div>

  <div>
    <!-- åå‰ -->
    åå‰
    <select name="example" id="who" class="title3">
      <option value="è‡ªåˆ†">è‡ªåˆ†</option>
      <option value="ãã®ä»–">ãã®ä»–</option>
    </select>
  </div>



  <div>
    <!-- åå‰ -->
    ã‚¿ã‚¤ãƒˆãƒ«
    <input type="text" id="username" class="title2">
  </div>

  <div class="setu1"> 
    <!-- ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ -->
   <dt class="setu2">èª¬æ˜</dt> 
    <textarea name="" id="text" cols="30" rows="10" class="setu"></textarea>
  </div>

  <div>
    <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
    <button id="send">é€ä¿¡</button>
  </div>

  <div>
    <!-- å…¨å‰Šé™¤ -->
    <button id="sakujyo">å…¨å‰Šé™¤</button>
  </div>



  <!-- ãƒ–ãƒ©ã‚¦ã‚¶ã®ç”»é¢ã«è¦‹ãˆã‚‹å†…å®¹ -->


  <!-- JQuery -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <!-- JQuery -->

  <!--** ä»¥ä¸‹Firebase **-->
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <!-- firebaseã®verãŒå¤‰ã‚ã‚‹ã®ã§ã€æ•°å­—ãŒã©ã‚“ã©ã‚“å¤‰åŒ–ã—ã¾ã™ğŸ™‹â€â™€ï¸ -->
  <!-- ã“ã“ã«firebaseã®scriptã‚’è²¼ã‚Šä»˜ã‘ã‚‹ -->
  <script src="https://www.gstatic.com/firebasejs/7.14.2/firebase.js"></script>

  <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#config-web-app -->

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyCqVg_NyEEVBLd7pb7QDJDzrHQlPvzfBZs",
      authDomain: "dev18-chat01-23024.firebaseapp.com",
      databaseURL: "https://dev18-chat01-23024.firebaseio.com",
      projectId: "dev18-chat01-23024",
      storageBucket: "dev18-chat01-23024.appspot.com",
      messagingSenderId: "258135251170",
      appId: "1:258135251170:web:d750825abc7c95217526bb"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    //firebaseã®ãƒ‡ãƒ¼ã‚¿ãƒ¼ãƒ™ãƒ¼ã‚¹ï¼ˆä¿å­˜ã•ã›ã‚‹å ´æ‰€ï¼‰ã‚’ä½¿ã„ã¾ã™ã‚ˆ
    const newPostRef = firebase.database().ref();

    // ã“ã“ã‹ã‚‰ä¸‹ã«jqueryã®å‡¦ç†ã‚’æ›¸ã„ã¦ç·´ç¿’ã—ã¾ã™
 
    $(function() {
    var nav = $('.a');
    //navã®ä½ç½®    
    var navTop = nav.offset().top;
    //ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ãŸã³ã«å®Ÿè¡Œ
    $(window).scroll(function () {
        var winTop = $(this).scrollTop();
        //ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ãŒnavã®ä½ç½®ã‚ˆã‚Šä¸‹ã ã£ãŸã‚‰ã‚¯ãƒ©ã‚¹fixedã‚’è¿½åŠ 
        if (winTop >= navTop) {
            nav.addClass('fixed')
        } else if (winTop <= navTop) {
            nav.removeClass('fixed')
        }
     });
    });


    // é€ä¿¡ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰æ¬¡ã®å‡¦ç†ã‚’ã™ã‚‹
    $("#send").on("click", function () {
      // ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã§é€ã‚‹
      newPostRef.push({
        who: $("#who").val(),//åå‰
        date: $("#date").val(),//æ—¥ä»˜
        username: $("#username").val(), //åå‰
        text: $("#text").val()//ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢
      })
      $("#date").val(""); 
      $("#text").val(""); //ç©ºã«ã™ã‚‹
      $("#username").val(""); //ç©ºã«ã™ã‚‹
    });


     // å…¨å‰Šé™¤ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰æ¬¡ã®å‡¦ç†ã‚’ã™ã‚‹
    $("#sakujyo").on("click", function () {
       newPostRef.remove();
       location.reload();
    });

    $("#send").on("click", function () {
      var f = $("#who").val();
      if(f == "è‡ªåˆ†"){
        console.log("è‡ªåˆ†");
        $("#output").append("<img src=imgs/è‡ªå·±ç´¹ä»‹ç”»åƒ.jpg width=80>");
      }else if(f == "ãã®ä»–"){
        $("#output").append("<img src=imgs/buke.png width=80>");
      }
    });

    // å—ä¿¡å‡¦ç†
    newPostRef.on("child_added", function (data) {
      var f = $("#who").val();
      if(f == "è‡ªåˆ†"){
        let v = data.val(); //ã“ã“ã«ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒå…¨ã¦å…¥ã£ã¦ãã‚‹
        // let k = data.key; //ä»Šå›ã¯ä½¿ã„ã¾ã›ã‚“

        console.log(v); //vã®å¤‰æ•°ã«å…¥ã£ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å…¨ã¦ã¿ã‚‹

        let str = `<p>${v.who}<p>${v.date}<br>${v.username}<br>${v.text}</p>`;

        // ã“ã“ã§ãƒ‡ãƒ¼ã‚¿ã‚’htmlã«åŸ‹ã‚è¾¼ã‚€
        $("#output").append(str);


      }else if(f == "ãã®ä»–"){
        let v = data.val(); //ã“ã“ã«ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒå…¨ã¦å…¥ã£ã¦ãã‚‹
        // let k = data.key; //ä»Šå›ã¯ä½¿ã„ã¾ã›ã‚“
        console.log(v); //vã®å¤‰æ•°ã«å…¥ã£ã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å…¨ã¦ã¿ã‚‹
        let str = `<p>${v.who}<p>${v.date}<br>${v.username}<br>${v.text}</p>`;
        // ã“ã“ã§ãƒ‡ãƒ¼ã‚¿ã‚’htmlã«åŸ‹ã‚è¾¼ã‚€
        $("#output").append(str);

      }
      
    })


    $("#text").on("keydown", function (e) {
      console.log(e, "event");

      if (e.keyCode === 13) {
        newPostRef.push({
          username: $("#username").val(), //åå‰
          text: $("#text").val(), //ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢
        })
        $("#text").val(""); //ç©ºã«ã™ã‚‹
        $("#username").val(""); //ç©ºã«ã™ã‚‹
      }
    })


  </script>
</body>

</html>